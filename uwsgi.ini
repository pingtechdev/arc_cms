# uWSGI configuration for ARC CMS
[uwsgi]

# Application settings
module = cms_core.wsgi:application
master = true
processes = 4
threads = 2
max-requests = 1000
max-requests-delta = 50

# Socket settings (use relative path)
socket = %(chdir)/tmp/arc_cms.sock
chmod-socket = 666
vacuum = true
die-on-term = true

# Process management (use relative paths)
pidfile = %(chdir)/tmp/arc_cms_uwsgi.pid
daemonize = %(chdir)/logs/uwsgi.log
log-maxsize = 50000000
log-backupcount = 5

# User and group (will be set by systemd)
# uid = ubuntu
# gid = ubuntu

# Working directory (will be set by systemd)
# chdir = /home/ubuntu/projects/arc-deploy/arc_cms
# home = /home/ubuntu/projects/arc-deploy/arc_cms/venv
# pythonpath = /home/ubuntu/projects/arc-deploy/arc_cms

# Environment variables
env = DJANGO_SETTINGS_MODULE=cms_core.settings

# Performance settings
buffer-size = 32768
harakiri = 60
harakiri-verbose = true
reload-mercy = 10
worker-reload-mercy = 10

# Memory management
memory-report = true
reload-on-as = 512
reload-on-rss = 192

# Security
chown-socket = ubuntu:ubuntu
chmod-socket = 666
single-interpreter = true

# Logging
log-4xx = true
log-5xx = true
log-slow = 2000

# Stats server (optional, for monitoring)
stats = /tmp/arc_cms_stats.sock
stats-http = true

# Enable threading
enable-threads = true
thunder-lock = true

# Plugin
plugin = python3

# Lazy loading
lazy-apps = true
single-interpreter = true
